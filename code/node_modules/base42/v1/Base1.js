var assign = require("../assign/assign1");
var createConstructor = require("../createConstructor/simple");

var Base = createConstructor();
Base.assign = assign;
Base.createConstructor = createConstructor;
Base.getConstructor = function(o){
	var Ext; // return me

	if (o && o.createConstructor){
		Ext = o.createConstructor.call(this, o);
		Ext.assign = this.assign;
		Ext.assign(this);
		
		// I had to move this below the above Ext.assign(this), because the Base/`this`.createConstructor was replacing it
		Ext.createConstructor = o.createConstructor;

		// prevent it from being assigned to prototype (in `.extend()`)
		delete o.createConstructor;
	} else {
		if (o && o.hasOwnProperty("constructor")){
			Ext = o.constructor;
			delete o.constructor; // prevents it from being assigned to prototype in `.extend()`
		} else {
			Ext = this.createConstructor(o);
		}
		Ext.assign = this.assign;
		Ext.assign(this);
	}

	Ext.base = this;

	return Ext;
};

Base.extend = function(o){
	var Ext = this.getConstructor(o);

	// Setup inheritance
	Ext.prototype = Object.create(this.prototype);
	Ext.prototype.constructor = Ext;
	Ext.prototype.name = Ext.name[0].toLowerCase() + Ext.name.substring(1);

	// Assign all arguments to the new prototype
	Ext.prototype.assign.apply(Ext.prototype, arguments);

	return Ext;
};

Base.prototype.assign = assign;
Base.prototype.instantiate = function(){};

module.exports = Base;