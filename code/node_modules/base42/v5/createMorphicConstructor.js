/*
Morphic obj should be returned from .config, not .instantiate:
 - if we use Proxy, we need to make sure no references are made to the underlying object
 - if we return the proxy from instantiate, there's a possibility the underlying object is passed via .set --> .adopt or something.


 .config could be replaced with a Symbol, and only used in dev mode.
 - all .config behaviors are for logging purposes... except config_tag, but that could just as easily go somewhere else...


!!! PROBLEM WITH THIS PATTERN: !!!
Let's say we return something that has an instantiate function.  When we create it, it'll run instantiate.  Then we return it (to morph `this` --> `ret`), and then it gets called again...
*/

var createConstructor = function(name){
	eval("var " + name + ";");
	var constructor = eval("(" + name + " = function " + name + "(){\r\n\
	if (!(this instanceof " + name + "))\r\n\
		return new (" + name + ".bind.apply(" + name + ", [null].concat([].slice.call(arguments)) ));\r\n\
	var ret = this.config.apply(this, arguments) || this;\r\n\
	ret.instantiate && ret.instantiate.apply(ret, arguments);\r\n\
	return ret;\r\n\
});");
	return constructor;
};

module.exports = createConstructor;