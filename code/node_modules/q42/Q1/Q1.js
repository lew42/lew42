var Coll1 = require("coll42/Coll1");

var Q1 = module.exports = Coll1.extend({
	name: "Q1",
	exec: function(){
		var q = this
			args = arguments;
		this.each(function(cb){
			cb.apply(q.ctx || q.parent || q, args);
		});
		return this.ctx || this.parent || this;
	},
	then: function(){
		this.append.apply(this, arguments);
	},
});

Q1.Promise = Q1.extend({
	name: "Promise",
	resolve: function(){
		if (!this.resolved){
			this.resolved = true;
			this.exec.apply(this, arguments);
		} else {
			console.warn("already resolved");
		}
	},
	then: function(cb){
		if (this.resolved){
			cb.apply(this, arguments);
		} else {
			this.append.apply(this, arguments);
		}
	},
	and: function(q){
		var ret = new Q1.Promise();
		this.then(function(){
			q.then(function(){
				ret.resolve.apply(ret, arguments);
			});
		});
		return ret;
	}
});